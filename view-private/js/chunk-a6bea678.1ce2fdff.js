(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a6bea678"],{5727:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-card",{attrs:{shadow:"never"}},[a("wafRuleDiag",{ref:"addRuleDiag",attrs:{wafRuleVisible:t.wafRuleVisible},on:{"my-event":t.addRuleData}}),a("el-row",{staticStyle:{"margin-bottom":"10px","margin-left":"10px"},attrs:{gutter:10}},[a("div",{staticStyle:{width:"300px",float:"left"}},[a("el-input",{attrs:{"prefix-icon":"el-icon-search",placeholder:"请输入搜索内容"},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.searchClick(e):null}},model:{value:t.ruleSearch,callback:function(e){t.ruleSearch=e},expression:"ruleSearch"}})],1),a("div",{staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:t.showAddRuleDiag}},[t._v("添加规则")]),a("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:t.setRulePriority}},[t._v("应用优先级")]),a("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:t.saveRule}},[t._v("保存为JSON")])],1)]),a("WafDivider"),a("el-row",{staticStyle:{"margin-top":"20px","margin-bottom":"20px","margin-left":"10px"},attrs:{gutter:10}},[a("el-col",{attrs:{span:4}},[t._v("\n\t\t\t\t规则开关: \n\t\t\t\t"),a("el-tooltip",{attrs:{content:t.ruleSwitch,placement:"top"}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-value":"on","inactive-value":"off"},on:{change:t.ruleClick},model:{value:t.ruleSwitch,callback:function(e){t.ruleSwitch=e},expression:"ruleSwitch"}})],1)],1),a("el-col",{directives:[{name:"show",rawName:"v-show",value:"args"===t.vmod||"post"===t.vmod,expression:"vmod === 'args' || vmod === 'post' "}],attrs:{span:4}},[t._v("\n\t\t\t\tHPP开关: \n\t\t\t\t"),a("el-tooltip",{attrs:{content:t.hppSwitch,placement:"top"}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-value":"on","inactive-value":"off"},on:{change:t.hppClick},model:{value:t.hppSwitch,callback:function(e){t.hppSwitch=e},expression:"hppSwitch"}})],1)],1),a("el-col",{attrs:{span:4}},[a("span",{staticStyle:{color:"red"}},[t._v("\n\t\t\t\t\t(点击应用生效)\n\t\t\t\t")]),t._v("\n\t\t\t\t当前数量：\n\t\t\t\t"),a("i",{staticClass:"red-fonts"},[t._v("\n\t\t\t\t\t"+t._s(t.ruleCount?t.ruleCount:0)+"\n\t\t\t\t")])])],1),a("el-tabs",{attrs:{type:"border-card","active-name":t.vmod},on:{"tab-click":t.handleTabClick},model:{value:t.vmod,callback:function(e){t.vmod=e},expression:"vmod"}},[a("el-tab-pane",{attrs:{name:"referer"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"fa fa-car"}),t._v(" referer")]),a("WafRuleTable",{attrs:{vMod:t.vmod,results:t.results},on:{editorRule:t.editorRuleDiag,handleDelete:t.delRule}})],1),a("el-tab-pane",{attrs:{name:"uri"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"fa fa-car"}),t._v(" uri")]),a("WafRuleTable",{attrs:{vMod:t.vmod,results:t.results},on:{editorRule:t.editorRuleDiag,handleDelete:t.delRule}})],1),a("el-tab-pane",{attrs:{name:"header"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"fa fa-car"}),t._v(" header")]),a("WafRuleTable",{attrs:{vMod:t.vmod,results:t.results},on:{editorRule:t.editorRuleDiag,handleDelete:t.delRule}})],1),a("el-tab-pane",{attrs:{name:"useragent"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"fa fa-car"}),t._v(" useragent")]),a("WafRuleTable",{attrs:{vMod:t.vmod,results:t.results},on:{editorRule:t.editorRuleDiag,handleDelete:t.delRule}})],1),a("el-tab-pane",{attrs:{name:"cookie"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"fa fa-car"}),t._v(" cookie")]),a("WafRuleTable",{attrs:{vMod:t.vmod,results:t.results},on:{editorRule:t.editorRuleDiag,handleDelete:t.delRule}})],1),a("el-tab-pane",{attrs:{name:"args"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"fa fa-car"}),t._v(" args")]),a("WafRuleTable",{attrs:{vMod:t.vmod,results:t.results},on:{editorRule:t.editorRuleDiag,handleDelete:t.delRule}})],1),a("el-tab-pane",{attrs:{name:"post"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"fa fa-car"}),t._v(" post")]),a("WafRuleTable",{attrs:{vMod:t.vmod,results:t.results},on:{editorRule:t.editorRuleDiag,handleDelete:t.delRule}})],1)],1)],1)],1)},i=[],l=(a("28a5"),a("7f7f"),function(){return a.e("chunk-533eacc2").then(a.bind(null,"8555"))}),r=function(){return a.e("chunk-24bbae2e").then(a.bind(null,"0882"))},n=function(){return a.e("chunk-2d0dd3ed").then(a.bind(null,"8120"))},o={data:function(){return{wafRuleVisible:!1,results:[],ruleSearch:"",temp:[],ruleCount:0,hppSwitch:"on",ruleSwitch:"on",vmod:":tab"!==this.$route.params.tab?this.$route.params.tab:"referer"}},mounted:function(){var t=":tab"!==this.$route.params.tab?this.$route.params.tab:"referer";":tab"!==t&&(this.setRuleTable(t),this.$router.push({name:"ruleBasic",params:{tab:t}}))},methods:{setRulePriority:function(){var t=this.secReq(this.api.globalConfig,"post",{action:"set",mod:this.vmod+"_Mod",value_type:"json",value:JSON.stringify(this.results)});"ok"===t.code?this.$notify({type:"success",title:"提示",message:"应用成功",duration:4e3}):this.$notify({type:"warning",title:"提示",message:t.msg,duration:4e3})},saveRule:function(){var t=this.secReq(this.api.save2js,"post",{action:"save",mod:"all_Mod"});"ok"===t.code?(this.setRuleTable(this.vmod),this.$notify({type:"success",title:"提示",message:"应用成功",duration:4e3})):this.$notify({type:"warning",title:"提示",message:t.msg,duration:4e3})},handleTabClick:function(t){var e=String(t.name);this.setRuleTable(e),this.$router.push({name:"ruleBasic",params:{tab:e}})},setRuleTable:function(t){for(var e=this.secReq(this.api.globalConfig,"post",{action:"get",mod:t+"_Mod"}),a=new Array,s=1;s<=e.msg.count;s++)a.push(e.msg[s]);return"args"===t||"post"===t?(this.ruleSwitch=String(e.msg.state.state),this.hppSwitch=String(e.msg.state.HPP_state)):this.ruleSwitch=String(e.msg.state),this.ruleCount=parseInt(e.msg.count),this.results=a,a},ruleClick:function(){"on"===this.ruleSwitch?(this.ruleSwitch="on",this.setRuleSwitch()):"off"===this.ruleSwitch&&(this.ruleSwitch="off",this.setRuleSwitch())},hppClick:function(){"on"===this.hppSwitch?(this.hppSwitch="on",this.setRuleSwitch()):"off"===this.hppSwitch&&(this.hppSwitch="off",this.setRuleSwitch())},showAddRuleDiag:function(){var t,e="",a="off",s="deny",i={name:"host",symbol:"",negate:"false",content:""};switch(this.vmod){case"referer":var l={name:"uri",symbol:"",negate:"false",content:""},r={name:"referer",symbol:"",negate:"false",content:""};t=[i,l,r];break;case"header":l={name:"uri",symbol:"",negate:"false",content:""};var n={name:"header",symbol:"",negate:"false",content:""};t=[i,l,n];break;case"uri":l={name:"uri",symbol:"",negate:"false",content:""};t=[i,l];break;case"useragent":var o={name:"useragent",symbol:"",negate:"false",content:""};t=[i,o];break;case"cookie":var u={name:"cookie",symbol:"",negate:"false",content:""};t=[i,u];break;case"args":var c={name:"args",symbol:"",negate:"false",content:""};t=[i,c];break;case"post":var d={name:"post",symbol:"",negate:"false",content:""};t=[i,d];break}this.$refs.addRuleDiag.ruleForm={id:e,state:a,action:s,table:t},this.$refs.addRuleDiag.title="添加",this.$refs.addRuleDiag.wafRuleVisible=!0},searchClick:function(){},setRuleSwitch:function(){var t;t="args"===this.vmod||"post"===this.vmod?JSON.stringify({state:this.ruleSwitch,HPP_state:this.hppSwitch}):this.ruleSwitch;var e=this.secReq(this.api.globalConfig,"post",{action:"set",mod:"base",id:this.vmod+"_Mod",value:t});"ok"===e.code?this.$notify({type:"success",title:"提示",message:"应用成功",duration:4e3}):this.$notify({type:"warning",title:"提示",message:e.msg,duration:4e3})},addRuleData:function(t){var e,a,s,i=this.$refs.addRuleDiag.ruleForm;a=""===this.$refs.addRuleDiag.typeValue?i["id"]+"-other":i["id"]+"-"+this.$refs.addRuleDiag.typeValue,s=i["state"]?"on":"off";var l=i["action"],r=this.formatRuleData(this.vmod,i["table"][0]);switch(this.vmod){case"referer":var n=this.formatRuleData(this.vmod,i["table"][1]),o=this.formatRuleData(this.vmod,i["table"][2]);b=JSON.stringify({id:a,state:s,action:l,hostname:r,referer:o,uri:n});break;case"header":n=this.formatRuleData(this.vmod,i["table"][1]);var u=this.formatRuleData(this.vmod,i["table"][2]);b=JSON.stringify({id:a,state:s,action:l,hostname:r,header:u,uri:n});break;case"uri":n=this.formatRuleData(this.vmod,i["table"][1]);b=JSON.stringify({id:a,state:s,action:l,hostname:r,uri:n});break;case"useragent":var c=this.formatRuleData(this.vmod,i["table"][1]);b=JSON.stringify({id:a,state:s,action:l,hostname:r,useragent:c});break;case"cookie":var d=this.formatRuleData(this.vmod,i["table"][1]);b=JSON.stringify({id:a,state:s,action:l,hostname:r,cookie:d});break;case"args":var h=this.formatRuleData(this.vmod,i["table"][1]);b=JSON.stringify({id:a,state:s,action:l,hostname:r,args:h});break;case"post":var f=this.formatRuleData(this.vmod,i["table"][1]);b=JSON.stringify({id:a,state:s,action:l,hostname:r,post:f});break}var m=this.$refs.addRuleDiag.title;if("添加"===m){var p={action:"add",mod:this.vmod+"_Mod",value:b};e=this.secReq(this.api.globalConfig,"post",p)}else{var v=JSON.parse(b),g=v["id"].split("-");if(i["id"].split("-")[i["id"].split("-").length-1]!==g[g.length-1]){v["id"]=g[0]+"-"+g[g.length-1];var b=JSON.stringify(v)}else{v["id"]=g[0]+"-"+g[g.length-1];b=JSON.stringify(v)}p={action:"set",mod:this.vmod+"_Mod",value_type:"json",id:t,value:b};e=this.secReq(this.api.globalConfig,"post",p),this.$refs.addRuleDiag.editorId=0}this.$refs.addRuleDiag.wafRuleVisible=!1,"ok"==e.code?this.$notify({type:"success",title:"提示",message:"应用成功",duration:4e3}):this.$notify({type:"warning",title:"提示",message:"应用失败",duration:4e3}),this.setRuleTable(this.vmod)},editorRuleDiag:function(t,e){this.$refs.addRuleDiag.title="编辑",this.$refs.addRuleDiag.editorId=e+1,this.$refs.addRuleDiag.wafRuleDiag("编辑",t)},formatRuleData:function(t,e){var a,s,i,l,r=e["symbol"];switch(r){case"in":s=e["content"],i=r;break;case"":s=e["content"],i=r;break;case"reg":s=e["content"],i=e["jioRegData"];break;case"dict":s=JSON.parse(e["content"]),i=r;break;case"len":var n=e["content"].split(",");s=[parseInt(n[0]),parseInt(n[1])],i=r;break;case"@token@":s=e["content"],i=r;break;default:s=JSON.parse(e["content"]),i=r;break}return l="false"!==e["negate"]&&!1!==e["negate"],a="header"===e["name"]?[s,i,e["headerArg"],l]:[s,i,l],a},delRule:function(t){var e=this;this.$confirm("此操作将删除选择的数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a=e.secReq(e.api.globalConfig,"post",{action:"del",mod:e.vmod+"_Mod",id:parseInt(t)+1});"ok"===a.code?(e.setRuleTable(e.vmod),e.$notify({type:"success",title:"提示",message:"应用成功",duration:4e3})):e.$notify({type:"warning",title:"提示",message:a.msg,duration:4e3})})}},components:{WafRuleTable:l,WafDivider:r,wafRuleDiag:n},watch:{$route:function(t,e){this.temp=this.results,":tab"===this.$route.params.tab&&this.$router.go({name:"ruleBasic",params:{tab:"referer"}})},ruleSearch:{handler:function(t,e){this.results=""===t?this.temp:this.results.filter(function(e){if(e.id.indexOf(t)>=0)return!0})}}}},u=o,c=(a("cfe8"),a("2877")),d=Object(c["a"])(u,s,i,!1,null,null,null);e["default"]=d.exports},"7f7f":function(t,e,a){var s=a("86cc").f,i=Function.prototype,l=/^\s*function ([^ (]*)/,r="name";r in i||a("9e1e")&&s(i,r,{configurable:!0,get:function(){try{return(""+this).match(l)[1]}catch(t){return""}}})},"92df":function(t,e,a){},cfe8:function(t,e,a){"use strict";var s=a("92df"),i=a.n(s);i.a}}]);