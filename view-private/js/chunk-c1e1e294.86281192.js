(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c1e1e294"],{"4dba":function(t,e,s){"use strict";s("cf63")},b1d6:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"app-container"},[e("el-card",{attrs:{shadow:"never"}},[e("el-row",{staticStyle:{"margin-bottom":"10px","margin-left":"10px"},attrs:{gutter:10}},[e("div",{staticStyle:{width:"300px",float:"left"}},[e("el-input",{attrs:{"prefix-icon":"el-icon-search",placeholder:"请输入搜索内容"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),e("div",{staticStyle:{float:"right"}},[e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.handleAdd}},[t._v("添加")]),e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.handleSave}},[t._v("保存")])],1)]),e("el-row",{staticStyle:{margin:"20px"}},[e("el-col",{attrs:{span:12}},[e("span",{staticStyle:{"margin-right":"20px"}},[t._v("IP规则配置:")]),e("el-radio-group",{on:{change:t.setbaseState},model:{value:t.state,callback:function(e){t.state=e},expression:"state"}},[e("el-radio",{attrs:{label:"on"}}),e("el-radio",{attrs:{label:"off"}})],1)],1),e("el-col",{attrs:{span:12}},[e("div",{staticStyle:{float:"right"}},[e("span",{staticStyle:{"margin-right":"20px"}},[t._v("当前数量："+t._s(t.pageTotal))]),e("span",{staticStyle:{color:"blue"}},[t._v("版本号：")]),t._v(t._s(t.version)+" ")])])],1),e("el-table",{attrs:{data:t.userList,border:""}},[e("el-table-column",{attrs:{label:"域名"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.host)+" ")]}}])}),e("el-table-column",{attrs:{label:"ip"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.ip)+" ")]}}])}),e("el-table-column",{attrs:{label:"动作",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.option)+" ")]}}])}),e("el-table-column",{attrs:{label:"操作",align:"center",width:"360","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-popover",{attrs:{placement:"top",width:"160"},model:{value:s.row.visible,callback:function(e){t.$set(s.row,"visible",e)},expression:"scope.row.visible"}},[e("p",[t._v("确定要删除吗?")]),e("div",{staticStyle:{"text-align":"right",margin:"0"}},[e("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){s.row.visible=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.handleDel(s.row)}}},[t._v("确定")])],1),e("el-button",{staticStyle:{color:"red","margin-left":"10px"},attrs:{slot:"reference",size:"mini",type:"text",icon:"el-icon-delete"},slot:"reference"},[t._v("删除")])],1)]}}])})],1),e("el-dialog",{attrs:{title:t.title,visible:t.open,width:"60%"},on:{"update:visible":function(e){t.open=e}}},[e("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:"图形化配置",name:"second"}},[e("el-form",{attrs:{"label-width":"100px",model:t.contents}},[e("el-row",{attrs:{gutter:10}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"匹配域名："}},[e("el-input",{attrs:{placeholder:"请输入匹配域名"},on:{change:t.ipChange},model:{value:t.domain,callback:function(e){t.domain="string"===typeof e?e.trim():e},expression:"domain"}})],1)],1),e("el-col",{staticStyle:{"line-height":"40px"},attrs:{span:12}},[t._v(" *时表示任意域名 ")])],1),e("el-row",{attrs:{gutter:10}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"IP："}},[e("el-input",{attrs:{placeholder:"请输入IP"},on:{change:t.ipChange},model:{value:t.ip,callback:function(e){t.ip=e},expression:"ip"}})],1)],1)],1),e("el-form-item",{attrs:{label:"执行动作："}},[e("el-select",{attrs:{placeholder:"请选择动作"},model:{value:t.contents.value,callback:function(e){t.$set(t.contents,"value",e)},expression:"contents.value"}},t._l(t.valueOption,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-row",{attrs:{gutter:10}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"生效时间："}},[e("el-input",{attrs:{placeholder:"请输入生效时间"},model:{value:t.contents.time,callback:function(e){t.$set(t.contents,"time",t._n(e))},expression:"contents.time"}})],1)],1),e("el-col",{staticStyle:{"line-height":"40px"},attrs:{span:12}},[t._v(" *单位s;0表示永久生效 ")])],1)],1)],1),e("el-tab-pane",{attrs:{label:"原始JSON配置",name:"first"}},[e("el-form",{ref:"form",attrs:{"label-width":"90px"}},[e("el-row",{attrs:{gutter:10}},[e("el-col",{attrs:{span:12}},["first"===t.activeName?e("vue-json-editor",{staticClass:"editorR",attrs:{mode:"code",lang:"zh"},model:{value:t.contents,callback:function(e){t.contents=e},expression:"contents"}}):t._e()],1),e("el-col",{attrs:{span:12}},["first"===t.activeName?e("codemirror",{staticClass:"editorR",attrs:{options:t.options},model:{value:t.code,callback:function(e){t.code=e},expression:"code"}}):t._e(),e("br"),e("el-link",{attrs:{href:"https://www.kancloud.cn/openstar/install/1136671",target:"_blank"}},[t._v("详情请点击此处，参考文档")])],1)],1)],1)],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.submitForm}},[t._v("确 定")]),e("el-button",{on:{click:t.cancel}},[t._v("取 消")])],1)],1)],1)],1)},a=[],n=(s("14d9"),s("8f94")),l=(s("a7be"),s("acdf"),s("7ba3"),s("a8d9"),s("db91"),s("b2b9"),s("f9d4"),s("45a3")),o=s("b1ef"),r=s("a417");const c=s("e762").Base64;var p={components:{vueJsonEditor:l["a"],codemirror:n["codemirror"]},data(){return{code:'\n\n{\n    "ip": "www.bsdfhk.com_111.111.111.111",\n    "value": "log",\n    "time": 120\n}\n\nip: 下划线前面有域名表示 仅对这个域名生效（不支持通配符）\nvalue取值为：deny/allow/log\n\n',options:{tabSize:4,mode:{name:"javascript",json:!0},theme:"darcula",lineNumbers:!0,line:!0,highlightSelectionMatches:{showToken:/\w/,annotateScrollbar:!0},styleSelectedText:!0,styleActiveLine:!0,hintOptions:{completeSingle:!0}},userList:[],tempList:[],pageTotal:0,state:"",version:"",search:"",open:!1,title:"",contents:{},activeName:"second",valueOption:[{label:"拦截",value:"deny"},{label:"放行",value:"allow"},{label:"仅记录",value:"log"}],domain:"",ip:""}},created(){this.getList()},methods:{handleClick(){if(!this.contents.ip)return;const t=this.contents.ip.split("_");t.length>1?(this.domain=t[0],this.ip=t[1]):(this.domain="*",this.ip=t[0])},ipChange(){"*"!==this.domain&&this.domain?this.contents.ip=this.domain+"_"+this.ip:this.contents.ip=this.ip},isJSON(t){try{var e=JSON.parse(t);return!("object"!=typeof e||!e)}catch(s){return!1}},getList(){var t={action:"get",ip:"all_ip"};Object(o["a"])(t).then(t=>{var e=t.msg,s=[];for(var i in e)if("state"!==i&&"count"!==i){var a={},n=i.split("_");1==n.length?(a.host="*",a.ip=n[0]):(a.host=n[0],a.ip=n[1]),a.option=e[i],s.push(a)}this.version=e.state.G_version,this.state=e.state.state,this.userList=s,this.tempList=s,this.pageTotal=s.length})},setbaseState(){var t={G_version:this.version,state:this.state},e={action:"set",mod:"base",id:"ip_Mod",value:JSON.stringify(t)};Object(r["b"])(e).then(t=>{"ok"===t.code?this.$notify({title:"成功",message:t.msg,type:"success"}):this.$notify({title:"警告",message:t.msg,type:"warning"})})},reset(){this.contents={}},cancel(){this.open=!1,this.reset()},handleAdd(){this.reset(),this.title="添加",this.open=!0},handleDel(t){var e=t.ip;"*"!=t.host&&(e=t.host+"_"+t.ip);var s={action:"del",ip:e};Object(o["a"])(s).then(t=>{"ok"===t.code?(this.$notify({title:"成功",message:t.msg,type:"success"}),this.open=!1,this.getList()):this.$notify({title:"警告",message:t.msg,type:"warning"})})},submitForm(){if(!this.isJSON(JSON.stringify(this.contents)))return this.$message.error("配置内容:json格式错误/没有内容"),!1;var t={action:"set",ip:this.contents.ip,value:this.contents.value,time:this.contents.time};Object(o["a"])(t).then(t=>{"ok"===t.code?(this.$notify({title:"成功",message:t.msg,type:"success"}),this.open=!1,this.getList(1)):this.$notify({title:"警告",message:t.msg,type:"warning"})})},handleSave(){var t={action:"save",mod:"all_Mod"};Object(r["h"])(t).then(t=>{"ok"==t.code?this.$notify({title:"成功",message:t.msg,type:"success"}):this.$notify({title:"警告",message:t.msg,type:"warning"})})}},filters:{match:function(t){return c.decode(t)}},watch:{$route(t,e){},search:{handler:function(t,e){this.userList=""===t?this.tempList:this.tempList.filter((function(e){if(e.ip.indexOf(t)>=0)return!0}))}}}},u=p,d=(s("4dba"),s("2877")),h=Object(d["a"])(u,i,a,!1,null,"35f0373c",null);e["default"]=h.exports},b1ef:function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));var i=s("b775"),a=s("4328"),n=s.n(a),l=s("365c");function o(t){return Object(i["a"])({url:""+l["a"].global.ipSet,method:"post",data:n.a.stringify(t)})}},cf63:function(t,e,s){}}]);